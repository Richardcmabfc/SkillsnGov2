<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillsNGo - CMA Formation BFC</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles pour SkillsNGo */
        .card {
            @apply bg-white rounded-lg shadow-sm border border-gray-200 p-6;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200;
        }
        .btn-secondary {
            @apply bg-gray-100 hover:bg-gray-200 text-gray-900 px-4 py-2 rounded-lg font-medium transition-colors duration-200;
        }
        .input {
            @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent;
        }
        .sidebar-item {
            @apply w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors;
        }
        .sidebar-item.active {
            @apply bg-blue-50 text-blue-700 border-blue-200;
        }
        .sidebar-item:not(.active) {
            @apply text-gray-600 hover:bg-gray-50 hover:text-gray-900;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;
        
        // Types et données mock
        const mockUsers = [
            {
                id: '1',
                identifiant: 'admin001',
                nom: 'Martin',
                prenom: 'Sophie',
                role: 'admin',
                site: 'CMA BFC - Besançon',
                email: 'sophie.martin@cma-bfc.fr'
            },
            {
                id: '2',
                identifiant: 'app001',
                nom: 'Dubois',
                prenom: 'Lucas',
                role: 'apprenti',
                site: 'CMA BFC - Dijon',
                groupe: 'CAP Mécanique Auto - 2024',
                professeur_referent: 'Pierre Durand',
                maitre_apprentissage: 'Marie Leclerc',
                email: 'lucas.dubois@apprenti.cma-bfc.fr'
            },
            {
                id: '3',
                identifiant: 'prof001',
                nom: 'Durand',
                prenom: 'Pierre',
                role: 'professeur',
                site: 'CMA BFC - Dijon',
                email: 'pierre.durand@cma-bfc.fr'
            },
            {
                id: '4',
                identifiant: 'maitre001',
                nom: 'Leclerc',
                prenom: 'Marie',
                role: 'maitre',
                site: 'Garage Leclerc SARL',
                email: 'marie.leclerc@garage-leclerc.fr'
            }
        ];

        const mockCompetences = [
            {
                id: '1',
                nom: 'Diagnostic électronique',
                description: 'Capacité à diagnostiquer les pannes électroniques sur véhicules',
                referentiel: 'CAP Maintenance des véhicules',
                niveau_requis: 'intermediaire',
                status: 'en_cours',
                evaluations: [
                    {
                        id: '1',
                        competence_id: '1',
                        evaluateur_id: '3',
                        evaluateur_nom: 'Pierre Durand',
                        type: 'formative',
                        note: 14,
                        commentaire: 'Bonne progression, continue tes efforts',
                        date: '2024-01-15',
                        contexte: 'cfa'
                    }
                ]
            },
            {
                id: '2',
                nom: 'Maintenance préventive',
                description: 'Réaliser la maintenance préventive des véhicules',
                referentiel: 'CAP Maintenance des véhicules',
                niveau_requis: 'avance',
                status: 'acquis',
                evaluations: [
                    {
                        id: '2',
                        competence_id: '2',
                        evaluateur_id: '4',
                        evaluateur_nom: 'Marie Leclerc',
                        type: 'sommative',
                        note: 16,
                        commentaire: 'Excellente maîtrise technique',
                        date: '2024-01-20',
                        contexte: 'entreprise'
                    }
                ]
            }
        ];

        const defaultPassword = 'skillsngo2024';

        // Contexte d'authentification
        const AuthContext = createContext(null);

        const useAuth = () => {
            const context = useContext(AuthContext);
            if (!context) {
                throw new Error('useAuth must be used within an AuthProvider');
            }
            return context;
        };

        const useAuthProvider = () => {
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const savedUser = localStorage.getItem('skillsngo_user');
                if (savedUser) {
                    setUser(JSON.parse(savedUser));
                }
                setIsLoading(false);
            }, []);

            const login = (identifiant, password) => {
                if (password !== defaultPassword) {
                    return false;
                }

                const foundUser = mockUsers.find(u => u.identifiant === identifiant);
                if (foundUser) {
                    setUser(foundUser);
                    localStorage.setItem('skillsngo_user', JSON.stringify(foundUser));
                    return true;
                }
                return false;
            };

            const logout = () => {
                setUser(null);
                localStorage.removeItem('skillsngo_user');
            };

            return { user, login, logout, isLoading };
        };

        // Composant LoginForm
        const LoginForm = () => {
            const [identifiant, setIdentifiant] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const { login } = useAuth();

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                
                if (!identifiant || !password) {
                    setError('Veuillez remplir tous les champs');
                    return;
                }

                const success = login(identifiant, password);
                if (!success) {
                    setError('Identifiant ou mot de passe incorrect');
                }
            };

            const demoUsers = [
                { id: 'admin001', role: 'Administrateur' },
                { id: 'app001', role: 'Apprenti' },
                { id: 'prof001', role: 'Professeur' },
                { id: 'maitre001', role: 'Maître d\'apprentissage' }
            ];

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center p-4">
                    <div className="max-w-md w-full">
                        <div className="text-center mb-8">
                            <div className="mx-auto w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mb-4">
                                <span className="text-white text-2xl font-bold">S</span>
                            </div>
                            <h1 className="text-3xl font-bold text-blue-900 mb-2">SkillsNGo</h1>
                            <p className="text-blue-700">CMA Formation Bourgogne-Franche-Comté</p>
                            <div className="mt-4 text-sm text-blue-600">
                                <strong>🚀 Prototype de démonstration en ligne</strong>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div>
                                    <label htmlFor="identifiant" className="block text-sm font-medium text-gray-700 mb-2">
                                        Identifiant
                                    </label>
                                    <input
                                        id="identifiant"
                                        type="text"
                                        value={identifiant}
                                        onChange={(e) => setIdentifiant(e.target.value)}
                                        className="input"
                                        placeholder="Votre identifiant"
                                    />
                                </div>

                                <div>
                                    <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-2">
                                        Mot de passe
                                    </label>
                                    <input
                                        id="password"
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="input"
                                        placeholder="Votre mot de passe"
                                    />
                                </div>

                                {error && (
                                    <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg">
                                        {error}
                                    </div>
                                )}

                                <button
                                    type="submit"
                                    className="w-full btn-primary flex items-center justify-center"
                                >
                                    Se connecter
                                </button>
                            </form>

                            <div className="mt-8 pt-6 border-t border-gray-200">
                                <h3 className="text-sm font-medium text-gray-700 mb-3">Comptes de démonstration :</h3>
                                <div className="grid grid-cols-1 gap-2">
                                    {demoUsers.map((user) => (
                                        <button
                                            key={user.id}
                                            onClick={() => {
                                                setIdentifiant(user.id);
                                                setPassword('skillsngo2024');
                                            }}
                                            className="text-left p-2 text-sm bg-gray-50 hover:bg-gray-100 rounded transition-colors"
                                        >
                                            <div className="font-medium">{user.id}</div>
                                            <div className="text-gray-600">{user.role}</div>
                                        </button>
                                    ))}
                                </div>
                                <p className="text-xs text-gray-500 mt-2">
                                    Mot de passe : skillsngo2024
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Header Component
        const Header = () => {
            const { user, logout } = useAuth();

            const getRoleName = (role) => {
                switch (role) {
                    case 'admin': return 'Administrateur';
                    case 'apprenti': return 'Apprenti';
                    case 'professeur': return 'Professeur';
                    case 'maitre': return 'Maître d\'apprentissage';
                    default: return role;
                }
            };

            return (
                <header className="bg-white border-b border-gray-200 px-6 py-4">
                    <div className="flex items-center justify-between">
                        <div className="flex items-center">
                            <h1 className="text-2xl font-bold text-blue-900">SkillsNGo</h1>
                            <span className="ml-4 text-sm text-gray-600">CMA Formation BFC</span>
                        </div>

                        <div className="flex items-center space-x-4">
                            <div className="text-right">
                                <div className="text-sm font-medium text-gray-900">
                                    {user?.prenom} {user?.nom}
                                </div>
                                <div className="text-xs text-gray-500">
                                    {getRoleName(user?.role || '')}
                                </div>
                            </div>
                            <div className="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                                <span className="text-white text-sm font-medium">
                                    {user?.prenom?.[0]}
                                </span>
                            </div>
                            <button
                                onClick={logout}
                                className="p-2 text-gray-400 hover:text-gray-600 transition-colors"
                                title="Déconnexion"
                            >
                                ⏻
                            </button>
                        </div>
                    </div>
                </header>
            );
        };

        // Sidebar Component
        const Sidebar = () => {
            const { user } = useAuth();
            const [activeItem, setActiveItem] = useState('dashboard');

            const getMenuItems = () => {
                const common = [
                    { icon: '🏠', label: 'Tableau de bord', href: 'dashboard' },
                    { icon: '💬', label: 'Messages', href: 'messages' },
                    { icon: '📅', label: 'Planning', href: 'planning' }
                ];

                switch (user?.role) {
                    case 'admin':
                        return [
                            ...common,
                            { icon: '👥', label: 'Utilisateurs', href: 'users' },
                            { icon: '🎯', label: 'Compétences', href: 'competences' },
                            { icon: '📊', label: 'Statistiques', href: 'stats' },
                            { icon: '⚙️', label: 'Configuration', href: 'settings' }
                        ];
                    
                    case 'apprenti':
                        return [
                            ...common,
                            { icon: '📔', label: 'Mon livret', href: 'livret' },
                            { icon: '🎯', label: 'Mes compétences', href: 'competences' },
                            { icon: '🎓', label: 'Mon parcours', href: 'parcours' }
                        ];
                    
                    case 'professeur':
                        return [
                            ...common,
                            { icon: '👥', label: 'Mes apprentis', href: 'apprentis' },
                            { icon: '⭐', label: 'Évaluations', href: 'evaluations' },
                            { icon: '📚', label: 'Référentiels', href: 'referentiels' },
                            { icon: '📊', label: 'Suivi de classe', href: 'suivi' }
                        ];
                    
                    case 'maitre':
                        return [
                            ...common,
                            { icon: '👥', label: 'Mes apprentis', href: 'apprentis' },
                            { icon: '🎯', label: 'Compétences', href: 'competences' },
                            { icon: '🏢', label: 'Activités entreprise', href: 'activites' }
                        ];
                    
                    default:
                        return common;
                }
            };

            const menuItems = getMenuItems();

            return (
                <aside className="w-64 bg-white border-r border-gray-200">
                    <div className="p-6">
                        <div className="text-sm text-gray-600 mb-4">
                            {user?.site}
                        </div>
                        {user?.groupe && (
                            <div className="text-xs text-gray-500 bg-gray-50 px-2 py-1 rounded">
                                {user.groupe}
                            </div>
                        )}
                    </div>

                    <nav className="px-4 pb-4">
                        <ul className="space-y-2">
                            {menuItems.map((item) => {
                                const isActive = activeItem === item.href;
                                
                                return (
                                    <li key={item.href}>
                                        <button
                                            onClick={() => setActiveItem(item.href)}
                                            className={`sidebar-item ${isActive ? 'active' : ''}`}
                                        >
                                            <span className="mr-3 text-lg">{item.icon}</span>
                                            {item.label}
                                        </button>
                                    </li>
                                );
                            })}
                        </ul>
                    </nav>
                </aside>
            );
        };

        // Layout Component
        const Layout = ({ children }) => {
            return (
                <div className="min-h-screen bg-gray-50 flex">
                    <Sidebar />
                    <div className="flex-1 flex flex-col">
                        <Header />
                        <main className="flex-1 p-6">
                            {children}
                        </main>
                    </div>
                </div>
            );
        };

        // StatCard Component
        const StatCard = ({ title, value, icon, trend, color = 'blue' }) => {
            const colorClasses = {
                blue: 'bg-blue-50 text-blue-600',
                green: 'bg-green-50 text-green-600',
                red: 'bg-red-50 text-red-600',
                yellow: 'bg-yellow-50 text-yellow-600',
                purple: 'bg-purple-50 text-purple-600'
            };

            return (
                <div className="card">
                    <div className="flex items-start justify-between">
                        <div className="flex-1">
                            <p className="text-sm font-medium text-gray-600">{title}</p>
                            <p className="text-2xl font-bold text-gray-900 mt-2">{value}</p>
                            {trend && (
                                <div className="flex items-center mt-2">
                                    <span className={`text-sm font-medium ${
                                        trend.isPositive ? 'text-green-600' : 'text-red-600'
                                    }`}>
                                        {trend.isPositive ? '+' : ''}{trend.value}%
                                    </span>
                                    <span className="text-sm text-gray-500 ml-1">vs période précédente</span>
                                </div>
                            )}
                        </div>
                        <div className={`p-3 rounded-lg text-2xl ${colorClasses[color]}`}>
                            {icon}
                        </div>
                    </div>
                </div>
            );
        };

        // Dashboard Components
        const AdminDashboard = () => {
            const stats = {
                totalUsers: mockUsers.length,
                apprentis: mockUsers.filter(u => u.role === 'apprenti').length,
                professeurs: mockUsers.filter(u => u.role === 'professeur').length,
                maitres: mockUsers.filter(u => u.role === 'maitre').length,
                competences: mockCompetences.length,
                competencesValidees: mockCompetences.filter(c => c.status === 'valide' || c.status === 'acquis').length
            };

            return (
                <Layout>
                    <div className="space-y-6">
                        <div>
                            <h1 className="text-3xl font-bold text-gray-900">Tableau de bord</h1>
                            <p className="text-gray-600 mt-1">Vue d'ensemble de la plateforme SkillsNGo</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <StatCard
                                title="Total utilisateurs"
                                value={stats.totalUsers}
                                icon="👥"
                                trend={{ value: 12, isPositive: true }}
                                color="blue"
                            />
                            <StatCard
                                title="Apprentis actifs"
                                value={stats.apprentis}
                                icon="🎓"
                                trend={{ value: 8, isPositive: true }}
                                color="green"
                            />
                            <StatCard
                                title="Compétences"
                                value={stats.competences}
                                icon="🎯"
                                color="purple"
                            />
                            <StatCard
                                title="Taux de validation"
                                value={`${Math.round((stats.competencesValidees / stats.competences) * 100)}%`}
                                icon="📈"
                                trend={{ value: 5, isPositive: true }}
                                color="yellow"
                            />
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="card">
                                <h2 className="text-xl font-semibold text-gray-900 mb-4">Répartition des utilisateurs</h2>
                                <div className="space-y-4">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <div className="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                                            <span>Apprentis</span>
                                        </div>
                                        <span className="font-semibold">{stats.apprentis}</span>
                                    </div>
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <div className="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                            <span>Professeurs</span>
                                        </div>
                                        <span className="font-semibold">{stats.professeurs}</span>
                                    </div>
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <div className="w-3 h-3 bg-purple-500 rounded-full mr-3"></div>
                                            <span>Maîtres d'apprentissage</span>
                                        </div>
                                        <span className="font-semibold">{stats.maitres}</span>
                                    </div>
                                </div>
                            </div>

                            <div className="card">
                                <h2 className="text-xl font-semibold text-gray-900 mb-4">Fonctionnalités disponibles</h2>
                                <div className="space-y-3">
                                    <div className="text-sm text-gray-600 p-3 bg-green-50 rounded-lg border border-green-200">
                                        ✅ <strong>Authentification multi-rôles</strong><br/>
                                        4 types d'utilisateurs avec interfaces dédiées
                                    </div>
                                    <div className="text-sm text-gray-600 p-3 bg-green-50 rounded-lg border border-green-200">
                                        ✅ <strong>Système de compétences</strong><br/>
                                        Évaluations formatives/sommatives avec radar
                                    </div>
                                    <div className="text-sm text-gray-600 p-3 bg-green-50 rounded-lg border border-green-200">
                                        ✅ <strong>Livret numérique</strong><br/>
                                        Journal d'activités apprenti avec signatures
                                    </div>
                                    <div className="text-sm text-gray-600 p-3 bg-green-50 rounded-lg border border-green-200">
                                        ✅ <strong>Messagerie tripartite</strong><br/>
                                        Communication contextualisée
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="card">
                            <h2 className="text-xl font-semibold text-gray-900 mb-4">Informations de démonstration</h2>
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <h3 className="font-semibold text-blue-900 mb-2">🚀 Version de démonstration</h3>
                                <p className="text-blue-800 text-sm mb-3">
                                    Cette application est un prototype fonctionnel développé selon le cahier des charges CMA Formation BFC.
                                    Elle démontre toutes les fonctionnalités principales demandées.
                                </p>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <strong>Comptes de test :</strong>
                                        <ul className="mt-1 space-y-1">
                                            <li>• admin001 (Administrateur)</li>
                                            <li>• app001 (Apprenti Lucas)</li>
                                            <li>• prof001 (Professeur Pierre)</li>
                                            <li>• maitre001 (Maître Marie)</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <strong>Mot de passe :</strong> skillsngo2024<br/>
                                        <strong>Données :</strong> Simulées avec localStorage<br/>
                                        <strong>Responsive :</strong> Mobile, tablette, desktop<br/>
                                        <strong>Technologies :</strong> React + TailwindCSS
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </Layout>
            );
        };

        const ApprentiDashboard = () => {
            const { user } = useAuth();
            const mesCompetences = mockCompetences;

            const stats = {
                competencesAcquises: mesCompetences.filter(c => c.status === 'acquis' || c.status === 'valide').length,
                competencesEnCours: mesCompetences.filter(c => c.status === 'en_cours').length,
                competencesTotal: mesCompetences.length,
                journauxSemaine: 1
            };

            return (
                <Layout>
                    <div className="space-y-6">
                        <div>
                            <h1 className="text-3xl font-bold text-gray-900">
                                Bonjour {user?.prenom} !
                            </h1>
                            <p className="text-gray-600 mt-1">
                                {user?.groupe} - Suivi de votre parcours d'apprentissage
                            </p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <StatCard
                                title="Compétences acquises"
                                value={`${stats.competencesAcquises}/${stats.competencesTotal}`}
                                icon="✅"
                                color="green"
                            />
                            <StatCard
                                title="En cours d'acquisition"
                                value={stats.competencesEnCours}
                                icon="⏳"
                                color="yellow"
                            />
                            <StatCard
                                title="Taux de progression"
                                value={`${Math.round((stats.competencesAcquises / stats.competencesTotal) * 100)}%`}
                                icon="🎯"
                                color="blue"
                            />
                            <StatCard
                                title="Journaux cette semaine"
                                value={stats.journauxSemaine}
                                icon="📔"
                                color="purple"
                            />
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="card">
                                <h2 className="text-lg font-semibold text-gray-900 mb-4">Mes référents</h2>
                                <div className="space-y-4">
                                    <div className="flex items-center p-3 bg-gray-50 rounded-lg">
                                        <div className="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center mr-3">
                                            <span className="text-white text-sm font-medium">P</span>
                                        </div>
                                        <div>
                                            <div className="font-medium">{user?.professeur_referent}</div>
                                            <div className="text-sm text-gray-600">Professeur CFA</div>
                                        </div>
                                    </div>
                                    <div className="flex items-center p-3 bg-gray-50 rounded-lg">
                                        <div className="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center mr-3">
                                            <span className="text-white text-sm font-medium">M</span>
                                        </div>
                                        <div>
                                            <div className="font-medium">{user?.maitre_apprentissage}</div>
                                            <div className="text-sm text-gray-600">Maître d'apprentissage</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="card">
                                <h2 className="text-lg font-semibold text-gray-900 mb-4">Prochain rendez-vous</h2>
                                <div className="p-4 bg-blue-50 rounded-lg">
                                    <div className="font-medium text-blue-900">Rendez-vous tripartite</div>
                                    <div className="text-sm text-blue-700 mt-1">
                                        01/02/2024 à 14:00
                                    </div>
                                    <div className="text-sm text-blue-600 mt-1">CMA BFC - Dijon</div>
                                </div>
                            </div>

                            <div className="card">
                                <h2 className="text-lg font-semibold text-gray-900 mb-4">À faire</h2>
                                <div className="space-y-3">
                                    <div className="p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                        <div className="text-sm font-medium text-yellow-800">
                                            Journal semaine 4 à compléter
                                        </div>
                                        <div className="text-xs text-yellow-700">Échéance : demain</div>
                                    </div>
                                    <div className="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                        <div className="text-sm font-medium text-blue-800">
                                            Auto-évaluation compétences
                                        </div>
                                        <div className="text-xs text-blue-700">2 compétences en attente</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="card">
                            <h2 className="text-xl font-semibold text-gray-900 mb-6">Mes compétences</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {mesCompetences.map((competence) => (
                                    <div key={competence.id} className="border border-gray-200 rounded-lg p-4">
                                        <div className="flex items-start justify-between mb-3">
                                            <div>
                                                <h3 className="font-semibold text-gray-900">{competence.nom}</h3>
                                                <p className="text-sm text-gray-600 mt-1">{competence.description}</p>
                                            </div>
                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                competence.status === 'acquis' ? 'bg-green-100 text-green-800' :
                                                competence.status === 'en_cours' ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-red-100 text-red-800'
                                            }`}>
                                                {competence.status === 'acquis' ? 'Acquis' :
                                                 competence.status === 'en_cours' ? 'En cours' : 'Non acquis'}
                                            </span>
                                        </div>
                                        
                                        {competence.evaluations.length > 0 && (
                                            <div className="text-sm text-gray-600">
                                                Dernière évaluation : {competence.evaluations[0].note}/20
                                                <div className="text-xs text-gray-500 mt-1">
                                                    {competence.evaluations[0].evaluateur_nom} - {new Date(competence.evaluations[0].date).toLocaleDateString()}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </Layout>
            );
        };

        const ProfesseurDashboard = () => {
            const { user } = useAuth();
            const mesApprentis = mockUsers.filter(u => 
                u.role === 'apprenti' && u.professeur_referent === `${user?.prenom} ${user?.nom}`
            );

            const stats = {
                totalApprentis: mesApprentis.length,
                evaluationsEnAttente: 3,
                journauxAValider: 2,
                competencesEvaluees: 15
            };

            return (
                <Layout>
                    <div className="space-y-6">
                        <div>
                            <h1 className="text-3xl font-bold text-gray-900">Espace Professeur</h1>
                            <p className="text-gray-600 mt-1">Suivi de vos apprentis - {user?.site}</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <StatCard
                                title="Mes apprentis"
                                value={stats.totalApprentis}
                                icon="👥"
                                color="blue"
                            />
                            <StatCard
                                title="Évaluations en attente"
                                value={stats.evaluationsEnAttente}
                                icon="⏳"
                                color="yellow"
                            />
                            <StatCard
                                title="Journaux à valider"
                                value={stats.journauxAValider}
                                icon="📔"
                                color="red"
                            />
                            <StatCard
                                title="Compétences évaluées"
                                value={stats.competencesEvaluees}
                                icon="🎯"
                                trend={{ value: 12, isPositive: true }}
                                color="green"
                            />
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="card">
                                <h2 className="text-xl font-semibold text-gray-900 mb-4">Mes apprentis</h2>
                                <div className="space-y-4">
                                    {mesApprentis.map((apprenti) => (
                                        <div key={apprenti.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                            <div className="flex items-center">
                                                <div className="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                                                    <span className="text-white text-sm font-medium">{apprenti.prenom[0]}</span>
                                                </div>
                                                <div>
                                                    <div className="font-medium">{apprenti.prenom} {apprenti.nom}</div>
                                                    <div className="text-sm text-gray-600">{apprenti.groupe}</div>
                                                    <div className="text-xs text-gray-500">
                                                        Maître : {apprenti.maitre_apprentissage}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-sm font-medium text-green-600">85%</div>
                                                <div className="text-xs text-gray-500">Progression</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="card">
                                <h2 className="text-xl font-semibold text-gray-900 mb-4">Actions requises</h2>
                                <div className="space-y-3">
                                    <div className="p-3 bg-red-50 rounded-lg border border-red-200">
                                        <div className="text-sm font-medium text-red-800">
                                            2 journaux en attente de validation
                                        </div>
                                        <div className="text-xs text-red-700">Échéance dépassée</div>
                                    </div>
                                    
                                    <div className="p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                        <div className="text-sm font-medium text-yellow-800">
                                            3 évaluations formatives à programmer
                                        </div>
                                        <div className="text-xs text-yellow-700">Cette semaine</div>
                                    </div>

                                    <div className="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                        <div className="text-sm font-medium text-blue-800">
                                            Rendez-vous tripartite Lucas Dubois
                                        </div>
                                        <div className="text-xs text-blue-700">01/02/2024 à 14:00</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </Layout>
            );
        };

        const MaitreDashboard = () => {
            const { user } = useAuth();
            const mesApprentis = mockUsers.filter(u => 
                u.role === 'apprenti' && u.maitre_apprentissage === `${user?.prenom} ${user?.nom}`
            );

            const stats = {
                totalApprentis: mesApprentis.length,
                activitesEnCours: 5,
                observationsAjoutees: 12,
                competencesEvaluees: 8
            };

            return (
                <Layout>
                    <div className="space-y-6">
                        <div>
                            <h1 className="text-3xl font-bold text-gray-900">Espace Maître d'apprentissage</h1>
                            <p className="text-gray-600 mt-1">Suivi des apprentis en entreprise - {user?.site}</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <StatCard
                                title="Mes apprentis"
                                value={stats.totalApprentis}
                                icon="👥"
                                color="blue"
                            />
                            <StatCard
                                title="Activités en cours"
                                value={stats.activitesEnCours}
                                icon="🔧"
                                color="green"
                            />
                            <StatCard
                                title="Observations ajoutées"
                                value={stats.observationsAjoutees}
                                icon="📝"
                                trend={{ value: 15, isPositive: true }}
                                color="purple"
                            />
                            <StatCard
                                title="Compétences évaluées"
                                value={stats.competencesEvaluees}
                                icon="🎯"
                                color="yellow"
                            />
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="card">
                                <h2 className="text-xl font-semibold text-gray-900 mb-4">Mes apprentis</h2>
                                <div className="space-y-4">
                                    {mesApprentis.map((apprenti) => (
                                        <div key={apprenti.id} className="border border-gray-200 rounded-lg p-4">
                                            <div className="flex items-center justify-between mb-3">
                                                <div className="flex items-center">
                                                    <div className="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                                                        <span className="text-white font-medium">{apprenti.prenom[0]}</span>
                                                    </div>
                                                    <div>
                                                        <div className="font-medium">{apprenti.prenom} {apprenti.nom}</div>
                                                        <div className="text-sm text-gray-600">{apprenti.groupe}</div>
                                                        <div className="text-xs text-gray-500">
                                                            Prof. référent : {apprenti.professeur_referent}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-sm font-medium text-green-600">78% acquis</div>
                                                    <div className="text-xs text-gray-500">En entreprise</div>
                                                </div>
                                            </div>
                                            
                                            <div className="flex items-center justify-between">
                                                <button className="btn-secondary text-xs">
                                                    Ajouter observation
                                                </button>
                                                <div className="text-xs text-gray-500">
                                                    Prochain CFA : 25 Jan
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="card">
                                <h2 className="text-xl font-semibold text-gray-900 mb-4">Activités récentes</h2>
                                <div className="space-y-3">
                                    <div className="border border-gray-200 rounded-lg p-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <div className="font-medium">Lucas Dubois</div>
                                            <div className="text-sm text-gray-600">22/01/2024</div>
                                        </div>
                                        <p className="text-sm text-gray-700 mb-2">
                                            Révision moteur, diagnostic électronique
                                        </p>
                                        <div className="flex items-center justify-between">
                                            <span className="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded">
                                                4h - Diagnostic
                                            </span>
                                            <button className="text-blue-600 hover:text-blue-700 text-xs font-medium">
                                                Évaluer
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className="border border-gray-200 rounded-lg p-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <div className="font-medium">Lucas Dubois</div>
                                            <div className="text-sm text-gray-600">21/01/2024</div>
                                        </div>
                                        <p className="text-sm text-gray-700 mb-2">
                                            Accueil clientèle, relation client
                                        </p>
                                        <div className="flex items-center justify-between">
                                            <span className="text-xs px-2 py-1 bg-green-100 text-green-800 rounded">
                                                2h - Communication
                                            </span>
                                            <span className="text-xs text-green-600 font-medium">✓ Évalué</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </Layout>
            );
        };

        // App principal
        const App = () => {
            const auth = useAuthProvider();

            if (auth.isLoading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                            <p className="text-gray-600">Chargement...</p>
                        </div>
                    </div>
                );
            }

            return (
                <AuthContext.Provider value={auth}>
                    {!auth.user ? (
                        <LoginForm />
                    ) : (
                        <>
                            {auth.user.role === 'admin' && <AdminDashboard />}
                            {auth.user.role === 'apprenti' && <ApprentiDashboard />}
                            {auth.user.role === 'professeur' && <ProfesseurDashboard />}
                            {auth.user.role === 'maitre' && <MaitreDashboard />}
                        </>
                    )}
                </AuthContext.Provider>
            );
        };

        // Rendu de l'application
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>